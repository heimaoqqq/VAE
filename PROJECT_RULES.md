# 🔧 项目开发规则

## 📊 微多普勒数据处理规则

### 1. **生成参数规则**
- **指导强度**: 必须使用 >= 30 的极端指导强度
- **推理步数**: 必须使用 >= 150 的推理步数
- **条件dropout**: 训练时应使用 <= 0.05 的低dropout率

### 2. **用户ID映射规则**
- **必须验证**: 每次推理前必须验证用户ID映射是否正确
- **数据目录**: 必须提供数据目录以获取正确的用户映射
- **映射逻辑**: 使用与训练时一致的目录扫描和排序逻辑

### 3. **验证规则**
- **分类器训练**: 使用 >= 1000 样本每类，>= 25 轮训练
- **成功标准**: 置信度 > 0.8 算成功，成功率 >= 60% 为良好
- **先简化测试**: 遇到错误时先用简化版工具测试

## 🔧 代码开发规则

### 1. **错误处理规则**
- **数组操作**: 必须添加边界检查，避免索引越界
- **文件操作**: 必须检查文件/目录是否存在
- **导入检查**: 确保所有导入的函数/类确实存在

### 2. **调试规则**
- **详细日志**: 添加详细的调试信息输出
- **渐进测试**: 从简单功能开始，逐步增加复杂度
- **错误恢复**: 提供降级方案和错误恢复机制

### 3. **Git提交规则**
- **小步提交**: 每次修复一个具体问题就提交
- **清晰描述**: 使用emoji和清晰的提交信息
- **测试验证**: 提交前确保代码能正常运行

## 🎯 验证失败诊断规则

### 1. **诊断顺序**
1. 先检查基本功能（数据加载、模型加载）
2. 再检查用户ID映射是否正确
3. 然后检查分类器是否正常工作
4. 最后检查生成参数是否合适

### 2. **参数调整规则**
- **保守 → 激进**: 从保守参数开始，逐步增加强度
- **单一变量**: 每次只调整一个参数，观察效果
- **记录结果**: 详细记录每次调整的效果

### 3. **重新训练决策规则**
- **极端参数测试**: 先用极端参数测试，成功率 < 30% 才考虑重新训练
- **条件编码器**: 检查嵌入相似度，> 0.95 需要重新训练
- **数据分析**: 先分析真实数据差异，确认问题根源

## 💡 微多普勒特定规则

### 1. **数据特征理解**
- **步态特征**: 微多普勒反映个人步态特征，差异虽小但有意义
- **频域分析**: 重点关注频率重心、扩散、峰值位置差异
- **时域分析**: 关注时间轴上的模式变化

### 2. **模型优化规则**
- **极端指导**: 对于微小差异，必须使用极端指导强度
- **精细分类**: 分类器需要更多数据和更长训练时间
- **集成验证**: 考虑使用多个分类器集成验证

### 3. **实验设计规则**
- **对照实验**: 同时测试不同指导强度的效果
- **量化分析**: 使用数值指标量化用户间差异
- **可视化验证**: 生成图像的可视化对比分析

## 🚀 工具使用规则

### 1. **工具选择规则**
- **简化优先**: 遇到问题先用简化版工具诊断
- **渐进复杂**: 从基本功能测试到完整分析
- **专用工具**: 针对特定问题使用专门工具

### 2. **参数配置规则**
- **微多普勒配置**: 使用专门的微多普勒参数配置
- **显存优化**: 根据环境限制调整批次大小和样本数
- **时间平衡**: 在准确性和运行时间间找平衡

### 3. **结果解释规则**
- **多维评估**: 不只看成功率，还要看置信度分布
- **趋势分析**: 关注参数调整后的趋势变化
- **根因分析**: 深入分析失败的根本原因

## 📋 检查清单

### 每次生成前检查：
- [ ] 用户ID映射是否正确？
- [ ] 指导强度是否 >= 30？
- [ ] 推理步数是否 >= 150？
- [ ] 数据目录路径是否正确？

### 每次验证前检查：
- [ ] 分类器训练数据是否充足？
- [ ] 训练轮数是否 >= 25？
- [ ] 图像预处理是否一致？
- [ ] 验证标准是否合理？

### 每次提交前检查：
- [ ] 代码是否能正常运行？
- [ ] 错误处理是否完善？
- [ ] 调试信息是否充足？
- [ ] 提交信息是否清晰？
